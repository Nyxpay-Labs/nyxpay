# Zero-Knowledge System

The NyxPay zero-knowledge system provides cryptographic proofs that demonstrate transaction validity without revealing sensitive information such as amounts, account balances, or transaction relationships.

## Overview

NyxPay uses zero-knowledge proofs to enable private transactions on Solana. The proofs demonstrate that transactions satisfy protocol invariants (balance preservation, non-negative transfers, ownership) without revealing the values that establish those properties.

## Why Zero-Knowledge Proofs?

Zero-knowledge proofs enable NyxPay to provide privacy guarantees that are independent of other users' behavior. Unlike mixing protocols that rely on anonymity sets, NyxPay's privacy is cryptographic and deterministic.

### Properties Provided

1. **Privacy**: Transaction amounts and relationships are hidden from observers
2. **Verifiability**: Transactions can be verified as valid without revealing private information
3. **Selective Disclosure**: Users can prove specific properties without revealing others
4. **Auditability**: Compliance and auditing are possible through disclosure proofs

## Trust Assumptions

The zero-knowledge proof system assumes:

1. **Cryptographic Security**: The underlying cryptographic primitives (hash functions, elliptic curves) are secure
2. **Circuit Correctness**: The proof circuits correctly encode the protocol invariants
3. **Soundness**: Invalid proofs are rejected with overwhelming probability
4. **Zero-Knowledge**: Valid proofs reveal no information beyond validity

## Proof Types

### Transfer Proofs

Transfer proofs demonstrate that a transaction:
- Preserves total balance (no funds created or destroyed)
- Transfers non-negative amounts
- Is authorized by the account owner
- Does not constitute a double-spend

### Disclosure Proofs

Disclosure proofs enable selective disclosure of transaction properties. A user can prove:
- A transaction occurred within a time range
- A transaction amount is within a range
- A transaction involved specific accounts
- Other properties as needed for compliance

## Proof Generation

Proofs are generated by the wallet layer before transaction submission. The generation process:

1. **Collect Private Inputs**: Gather account balances, transfer amounts, and other private data
2. **Construct Circuit Inputs**: Format inputs for the zero-knowledge circuit
3. **Generate Proof**: Execute the proof generation algorithm
4. **Serialize Proof**: Serialize the proof for on-chain submission

## Proof Verification

Proofs are verified on-chain by the NyxPay program. The verification process:

1. **Deserialize Proof**: Parse the serialized proof
2. **Extract Public Inputs**: Extract public inputs (account addresses, etc.)
3. **Verify Proof**: Execute the proof verification algorithm
4. **Check Constraints**: Verify that the proof demonstrates all required properties

## Circuit Architecture

The zero-knowledge circuits are structured as follows:

- **Transfer Circuit**: Proves balance preservation, non-negative transfers, and ownership
- **Stealth Address Circuit**: Proves correct stealth address derivation
- **Disclosure Circuit**: Proves specific transaction properties

See [specs/circuit-boundaries.md](./specs/circuit-boundaries.md) for detailed circuit architecture.

## Proof Statements

See [specs/proof-statements.md](./specs/proof-statements.md) for formal definitions of all proof statements.

## Verification Flow

See [specs/verification-flow.md](./specs/verification-flow.md) for the end-to-end verification process.

## Future Extensions

The zero-knowledge system is designed to be extensible. New proof types and circuits can be added without breaking existing functionality. See [future/placeholder.md](./future/placeholder.md) for the extension mechanism.

## Security Considerations

1. **Circuit Audits**: All circuits must undergo security audits before deployment
2. **Proof Size**: Proof size affects transaction costs and must be optimized
3. **Verification Cost**: On-chain verification costs must be minimized
4. **Trusted Setup**: If using SNARKs, the trusted setup must be performed securely

## Implementation Notes

The zero-knowledge system is implemented using a proof system that provides:
- Succinct proofs (small proof size)
- Fast verification (suitable for on-chain verification)
- Zero-knowledge property (no information leakage)

The specific proof system and implementation details are documented in the circuit specifications.
